@model DoAn_LapTrinhWeb.DTOs.ProductDTOs
@using DoAn_LapTrinhWeb.Common
@using DoAn_LapTrinhWeb.Common.Helpers
@{
    ViewBag.Title = Model.product_name;
    ViewBag.ImageURL = Model.Image;
    ViewBag.Keyword = Model.product_name;
    ViewBag.Decription = Model.seo_title;
    ViewBag.Tag = Model.seo_title;
    Layout = "~/Views/Shared/Main_Layout.cshtml";
    <!--relatedproduct | path: "action ProductDetail" - controller"Products"-->
    //hiển thị nhựng sản phẩm liên quan đến loại sp đó "vd: laptop gaming, thì sẽ hiển thị nội dung liên quan đến laptop gaming
    var relatedproduct = (List<DoAn_LapTrinhWeb.Models.Product>)ViewBag.relatedproduct;
    var newsproducts = (List<DoAn_LapTrinhWeb.Models.NewsProducts>)ViewBag.newsproducts;
    var feedbackproduct = (List<DoAn_LapTrinhWeb.Model.Feedback>)ViewBag.feedbackproduct;
    var AvgFeedback = (List<DoAn_LapTrinhWeb.Model.Feedback>)ViewBag.AvgFeedback;
    var OrderFeedback = (List<DoAn_LapTrinhWeb.Model.Oder_Detail>)ViewBag.OrderFeedback;
    var feedbackimages = (List<DoAn_LapTrinhWeb.Model.Feedback_Image>)ViewBag.feedbackimages;
    var Accountfeedback = (List<DoAn_LapTrinhWeb.Models.Account>)ViewBag.Accountfeedback;
}
@section scripts{
    <script src="~/Scripts/my_js/rating_product.js"></script>
    <!--chia sẻ ảnh, bài viết, sản phẩm lên fb, instagram,...-->
    <script src="~/Scripts/my_js/button_share_fb.js"></script>
    <!--xử lý sự kiện thêm sản phẩm-->
    <script src="~/Scripts/my_js/product/detail.js"></script>
    <!--custom product images detail theo dạng slider sử dụng kèm carousel.min.js-->
    <script src="~/Scripts/my_js/product_detail.js"></script>
    <script src="https://unpkg.com/micromodal@0.4.6/dist/micromodal.min.js"></script>
}
<!--begin::Section-->
<div class="product_detail">
    <!--begin::Container-->
    <div class="container margin_mobile_fixed">
        <!--begin::Breadcrumb-->
        <div class="breadcrumb1">
            <ul class="breadcrumb__list">
                <li><a href="/"><i aria-hidden="true" class="fa fa-home"></i></a> <i aria-hidden="true" class="far fa-angle-right"></i></li>
                <li><a href="@Url.Action("Index", "Home")">Trang chủ</a> <i aria-hidden="true" class="far fa-angle-right"></i></li>
                <li><a href="/danh-muc/@Model.parent_genre_slug">@Model.parent_genre_name</a> <i aria-hidden="true" class="far fa-angle-right"></i></li>
                <li class="hide_li_breadcumb"><a href="/danh-muc/@Model.genre_slug">@Model.genre_name</a> <i aria-hidden="true" class="far fa-angle-right "></i></li>
                <li class="breadcrumb_active"><a href="">@Model.product_name</a></li>
            </ul>
        </div>
        <!--end::Breadcrumb-->
        <!--begin::Row-->
        <div class="row boderproductdetail mb-30px">
            <!--begin::Col-->
            <div class="col-md-12">
                <!--begin::Row-->
                <div class="row">
                    <!--begin::Col-->
                    <div class="col-md-5 p-3 h_pduct_detail">
                        <!--begin::product detail images-->
                        <!--"data-fslightbox" using script full sreen images | path: /Scripts/fslightbox.js -->
                        <!--id="slider", id="thumb" |path:Scripts/my_js/product_detail.js-->
                        <div id="slider" class="owl-carousel product-slider">
                            <!--begin::Pic-->
                            <div class="item">
                                @if (Model.Image != null)
                                {
                                    <a data-fslightbox href="@Model.Image">
                                        <img src="@Model.Image" />
                                    </a>
                                }
                            </div>
                            <!--end::Pic-->
                            <!--begin::Pic-->
                            <div class="item">
                                @if (Model.image_1 != null)
                                {
                                    <a data-fslightbox href="@Model.image_1">
                                        <img src="@Model.image_1" />
                                    </a>
                                }
                            </div>
                            <!--end::Pic-->
                            <!--begin::Pic-->
                            <div class="item">
                                @if (Model.image_2 != null)
                                {
                                    <a data-fslightbox href="@Model.image_2">
                                        <img src="@Model.image_2" />
                                    </a>
                                }
                            </div>
                            <!--end::Pic-->
                            <!--begin::Pic-->
                            <div class="item">
                                @if (Model.image_3 != null)
                                {
                                    <a data-fslightbox href="@Model.image_3">
                                        <img src="@Model.image_3" />
                                    </a>
                                }
                            </div>
                            <!--end::Pic-->
                            <!--begin::Pic-->
                            <div class="item">
                                @if (Model.image_4 != null)
                                {
                                    <a data-fslightbox href="@Model.image_4">
                                        <img src="@Model.image_4" />
                                    </a>
                                }
                            </div>
                            <!--end::Pic-->
                            <!--begin::Pic-->
                            <div class="item">
                                @if (Model.image_5 != null)
                                {
                                    <a data-fslightbox href="@Model.image_5">
                                        <img src="@Model.image_5" />
                                    </a>
                                }
                            </div>
                            <!--end::Pic-->
                        </div>
                        <!--begin::thumbnail carousel slider-->
                        <div id="thumb" class="owl-carousel product-thumb ">
                            <!--begin::Pic-->
                            <div class="item">
                                @if (Model.Image != null)
                                {
                                    <img src="@Model.Image" />
                                }
                            </div>
                            <!--end::Pic-->
                            <!--begin::Pic-->
                            <div class="item">
                                @if (Model.image_1 != null)
                                {
                                    <img src="@Model.image_1" />
                                }
                            </div>
                            <!--end::Pic-->
                            <!--begin::Pic-->
                            <div class="item">
                                @if (Model.image_2 != null)
                                {
                                    <img src="@Model.image_2" />
                                }
                            </div>
                            <!--end::Pic-->
                            <!--begin::Pic-->
                            <div class="item">
                                @if (Model.image_3 != null)
                                {
                                    <img src="@Model.image_3" />
                                }
                            </div>
                            <!--end::Pic-->
                            <!--begin::Pic-->
                            <div class="item">
                                @if (Model.image_4 != null)
                                {
                                    <img src="@Model.image_4" />
                                }
                            </div>
                            <!--end::Pic-->
                            <!--begin::Pic-->
                            <div class="item">
                                @if (Model.image_5 != null)
                                {
                                    <img src="@Model.image_5" />
                                }
                            </div>
                            <!--end::Pic-->
                        </div>
                        <!--end::thumbnail carousel slider-->
                        <!--end::product detail images-->
                    </div>
                    <!--begin::Col-->
                    <div class="col-md-7 p-3">
                        <!--begin::Row-->
                        <div class="row">
                            <!--begin::Product Name-->
                            <div class="product-heading">
                                <p class="name_product_detail">@Model.product_name </p>
                            </div>
                            <!--end::Product Name-->
                            <!--begin::Product ID-->
                            <div class="d-flex brand_sku">
                                <span>Thương hiệu:</span>
                                <a class="brand_pdtdetail" href="/danh-muc/@Model.brand_slug">@Model.brand_name<span class="spacing_word"></span></a>
                                <span class="">Mã SP: @Model.product_id</span><br>
                            </div>
                            <!--end::Product ID-->
                            <!--begin::Product Detail Price-->
                            <div class="price_product_detail">
                                @if (Model.discount_start < DateTime.Now && Model.discount_end > DateTime.Now && Model.discount_status.Trim() == "1")
                                {
                                    <span class="old_price_detail"><del>@Model.price.ToString("#,###₫")</del></span>
                                    <span class="new_price_detail">@((Model.price - Model.discount_price).ToString("#,0₫"))</span><span class="text-success ms-1 fs-14px">-@((((Model.price) / (Model.price)) - ((Model.price - Model.discount_price) / (Model.price))).ToString("0.00%"))</span>
                                }
                                else
                                {
                                    <span class="new_price_detail">@Model.price.ToString("#,###₫")</span>
                                }
                                <br />
                                <!--begin::Product Star-->
                                @{ double onestar = 1; int c_ontstar = 0; double truestar = 2; int c_truestar = 0;
                                    double threestar = 3; int c_threestar = 0; ; double fourstar = 4; int c_fourstar = 0;
                                    double fivestar = 5; int c_fivestar = 0; int totalrating = 0;
                                    foreach (var item in AvgFeedback)
                                    {
                                        foreach (var orderitem in OrderFeedback)
                                        {
                                            if (orderitem.product_id == item.product_id && item.product_id == Model.product_id && item.status == "2")
                                            {
                                                totalrating++;
                                                if (item.rate_star == 1)
                                                {
                                                    c_ontstar++;
                                                }
                                                if (item.rate_star == 2)
                                                {
                                                    c_truestar++;
                                                }
                                                if (item.rate_star == 3)
                                                {
                                                    c_threestar++;
                                                }
                                                if (item.rate_star == 4)
                                                {
                                                    c_fourstar++;
                                                }
                                                if (item.rate_star == 5)
                                                {
                                                    c_fivestar++;
                                                }
                                            }
                                        }
                                    }
                                    if ((((onestar * c_ontstar / totalrating) + (truestar * c_truestar / totalrating) +
                                    (threestar * c_threestar / totalrating) + (fourstar * c_fourstar / totalrating) +
                                    (fivestar * c_fivestar / totalrating)) >= 1) && (((onestar * c_ontstar / totalrating) +
                                    (truestar * c_truestar / totalrating) + (threestar * c_threestar / totalrating) +
                                    (fourstar * c_fourstar / totalrating) + (fivestar * c_fivestar / totalrating)) < 2))
                                    {
                                        <span class="rating me-2">
                                            <i class="fa fa-star" aria-hidden="true"></i>
                                            @for (int i = 1; i < 5; i++)
                                            {
                                                <i class="fa fa-star-o" aria-hidden="true"></i>
                                            }
                                        </span>
                                    }
                                    else if ((((onestar * c_ontstar / totalrating) + (truestar * c_truestar / totalrating) +
                                    (threestar * c_threestar / totalrating) + (fourstar * c_fourstar / totalrating) +
                                    (fivestar * c_fivestar / totalrating)) >= 2) && (((onestar * c_ontstar / totalrating) +
                                    (truestar * c_truestar / totalrating) + (threestar * c_threestar / totalrating) +
                                    (fourstar * c_fourstar / totalrating) + (fivestar * c_fivestar / totalrating)) < 3))
                                    {
                                        <span class="rating me-2">
                                            <i class="fa fa-star" aria-hidden="true"></i>
                                            <i class="fa fa-star" aria-hidden="true"></i>
                                            @for (int i = 1; i < 4; i++)
                                            {
                                                <i class="fa fa-star-o" aria-hidden="true"></i>
                                            }
                                        </span>
                                    }
                                    else if ((((onestar * c_ontstar / totalrating) + (truestar * c_truestar / totalrating) +
                                     (threestar * c_threestar / totalrating) + (fourstar * c_fourstar / totalrating) +
                                     (fivestar * c_fivestar / totalrating)) >= 3) && (((onestar * c_ontstar / totalrating) +
                                     (truestar * c_truestar / totalrating) + (threestar * c_threestar / totalrating) +
                                     (fourstar * c_fourstar / totalrating) + (fivestar * c_fivestar / totalrating)) < 4))
                                    {
                                        <span class="rating me-2">
                                            <i class="fa fa-star" aria-hidden="true"></i>
                                            <i class="fa fa-star" aria-hidden="true"></i>
                                            <i class="fa fa-star" aria-hidden="true"></i>
                                            @for (int i = 1; i < 3; i++)
                                            {
                                                <i class="fa fa-star-o" aria-hidden="true"></i>
                                            }
                                        </span>
                                    }
                                    else if ((((onestar * c_ontstar / totalrating) + (truestar * c_truestar / totalrating) +
                                     (threestar * c_threestar / totalrating) + (fourstar * c_fourstar / totalrating) +
                                     (fivestar * c_fivestar / totalrating)) >= 4) && (((onestar * c_ontstar / totalrating) +
                                     (truestar * c_truestar / totalrating) + (threestar * c_threestar / totalrating) +
                                     (fourstar * c_fourstar / totalrating) + (fivestar * c_fivestar / totalrating)) < 5))
                                    {
                                        <span class="rating me-2">
                                            <i class="fa fa-star" aria-hidden="true"></i>
                                            <i class="fa fa-star" aria-hidden="true"></i>
                                            <i class="fa fa-star" aria-hidden="true"></i>
                                            <i class="fa fa-star" aria-hidden="true"></i>
                                            @for (int i = 1; i < 2; i++)
                                            {
                                                <i class="fa fa-star-o" aria-hidden="true"></i>
                                            }
                                        </span>
                                    }
                                    else if (((onestar * c_ontstar / totalrating) + (truestar * c_truestar / totalrating) +
                                       (threestar * c_threestar / totalrating) + (fourstar * c_fourstar / totalrating) +
                                       (fivestar * c_fivestar / totalrating)) == 5)
                                    {
                                        <span class="rating me-2">
                                            @for (int i = 1; i <=5 ; i++)
                                            {
                                                <i class="fa fa-star" aria-hidden="true"></i>
                                            }
                                        </span>
                                    }
                                    else
                                    {
                                        <span class="rating me-2">
                                            @for (int i = 1; i <=5; i++)
                                            {
                                                <i class="fa fa-star-o" aria-hidden="true"></i>
                                            }
                                        </span>
                                    }
                                }
                                <!--begin::Product Star-->
                                <span class="review">(@ViewBag.CountFeedback Đánh giá)</span>
                            </div>
                            <!--end::Product Detail Price-->
                            <div class="mb-2 limit_specs">
                                @Html.Raw(Model.specification)
                            </div>
                            <!--begin::Discount-->
                            <div class="pro-special-offer-container">
                                <div class="spec-title d-flex align-items-center justify-content-between">
                                    <div class="spec-price font-weight-bold">
                                        KHUYẾN MÃI
                                    </div>
                                </div>
                                <ul class="ul">
                                    @if (ViewBag.CheckExistBannerDetail != null)
                                    {
                                        foreach (var banner_detail in ViewBag.BannerDetail)
                                        {
                                            foreach (var banner in ViewBag.Banner)
                                            {
                                                if (banner.banner_id == banner_detail.banner_id)
                                                {
                                                    <li>
                                                        <span class="text">
                                                            @if (banner.description == null || banner.description == "")
                                                            {
                                                                <span>@banner.banner_name - <a class="font_roboto_medium text-danger" href="/khuyen-mai/@banner.slug">Xem danh sách khuyến mãi tại đây</a></span>
                                                            }
                                                            else
                                                            {
                                                                <span> @banner.description - <a class="font_roboto_medium text-danger" href="/khuyen-mai/@banner.slug">Xem danh sách khuyến mãi tại đây</a></span>
                                                            }
                                                        </span>
                                                    </li>
                                                }
                                            }
                                        }
                                    }
                                    else
                                    {
                                        <li>
                                            <span class="text">Không có khuyễn mãi</span>
                                        </li>
                                    }
                                </ul>
                            </div>
                            <!--end::Discount-->
                            <!--begin::Detail Content-->
                            <div class="detail-contant">
                                <!--begin::Quantity-->
                                <div>
                                    @if (Model.quantity == "4" || Model.quantity == "5" || Model.quantity == "6" || Model.quantity == "7" || Model.quantity == "8" || Model.quantity == "9" || Model.quantity == "10")
                                    {
                                        <p class="status_stock"><span class="status status2"><i aria-hidden="true" class="fa fa-circle"></i>Còn ít</span></p>
                                    }
                                    else if (Model.quantity == "3")
                                    {
                                        <p class="status_stock"><span class="status status3"><i aria-hidden="true" class="fa fa-circle"></i>Còn 3 sản phẩm</span></p>
                                    }
                                    else if (Model.quantity == "2")
                                    {
                                        <p class="status_stock"><span class="status status3"><i aria-hidden="true" class="fa fa-circle"></i>Còn 2 sản phẩm</span></p>
                                    }
                                    else if (Model.quantity == "1")
                                    {
                                        <p class="status_stock"><span class="status status3"><i aria-hidden="true" class="fa fa-circle"></i>Còn 1 sản phẩm</span></p>
                                    }
                                    else if (Model.quantity == "0") //nếu quantity = 0 thì hiển thị hết hàng
                                    {
                                        <p class="status_stock"><span class="status status4"><i aria-hidden="true" class="fa fa-circle"></i>Hết hàng</span></p>
                                    }
                                    else //ngược lại các điều kiện trên thì hiển thị còn hàng
                                    {
                                        <p class="status_stock"><span class="status status1"><i aria-hidden="true" class="fa fa-circle"></i>Còn hàng</span></p>
                                    }
                                </div>
                                <!--end::Quantity-->
                                <!--begin::Form-->
                                <form class="cart" method="post" action="#">
                                    <!--nếu là quyền quản trị thì sẽ không được mua hàng, chỉ quyền người dùng mới được phép mua hàng-->
                                    @if (Model.quantity != "0")
                                    {
                                        <!--"Const.ROLE..." | path: /Common/Const.cs-->
                                        if (User.IsInRole(Const.ROLE_ADMIN_NAME) || User.IsInRole(Const.ROLE_EDITOR_NAME) || User.IsInRole(Const.ROLE_MODERATOR_NAME)) //Const.ROLE_ADMIN_NAME chỉ là đặt tên cho role thôi,trong databasse "0" là admin "1" là user(nguòi dùng)
                                        {
                                            <!--begin::Add to Cart-->
                                            <div class="quantity" style="margin-right:5px;">
                                                <input step="0" min="0" max="@Model.quantity" name="quantity" value="0" title="Số lượng" class="input-text qty text" type="number" readonly>
                                            </div>
                                            //nếu bạn là admin sẽ hiển thị nút này số âm
                                            <a class="btn bg-danger">For Users</a>
                                            <!--end::Add to Cart-->
                                        }
                                        else
                                        {
                                            <!--begin::Add to Cart-->
                                            //đã ràng buộc không cho nhập số âm
                                            <div class="quantity">
                                                <input step="1" min="1" max="@Model.quantity" name="quantity" value="1" oninput="validity.valid || (value = '');" title="số lượng" class="input-text qty text" size="4" type="number">
                                            </div>
                                            //nếu bạn là user sẽ thêm được số lượng", id="btnAddToCart" | path: ~/Scripts/my_js/product/detail.js
                                            <button type="button" id="btnAddToCart" data-id="@Model.product_id" class="btn bg-button">Thêm vào giỏ</button>
                                            <!--end::Add to Cart-->
                                        }
                                    }
                                    else
                                    {
                                        <!--begin::Add to Cart-->
                                        <div class="quantity">
                                            <input min="0" max="0" name="quantity" value="0" title="số lượng" class="input-text qty text" size="4" type="number">
                                        </div>
                                        // nếu số lượng của sản phẩm = 0 sẽ hiện lên button "Liên hệ", id="btnAddToCart" | path: ~/Scripts/my_js/product/detail.js
                                        <a class="btn bg-button ms-2" target="_blank" href="https://www.messenger.com/t/109633994706435/">Liên hệ</a>
                                        <!--end::Add to Cart-->
                                    }
                                </form>
                                <!--begin::Form-->
                                <!--begin::Button Share-->
                                <div class="share-post">
                                    <a href="#" class="share-text">Chia sẻ:</a>
                                    <ul class="social_icons">
                                        <!--id="fb-share-button" | path: /Scripts/my_js/button_share_fb.js-->
                                        <li><a href="#" id="fb-share-button"><img src="~/Images/svg/brand-logos/facebook-4.svg" class="img_button_share" /></a></li>
                                        <li><a href="#"><img src="~/Images/svg/brand-logos/twitter.svg" class="img_button_share" /></a></li>
                                        <li><a href="#"> <img src="~/Images/svg/brand-logos/pinterest-p.svg" class="img_button_share" /></a></li>
                                        <li><a href="#"><img src="~/Images/svg/brand-logos/github.svg" class="img_button_share" /></a></li>
                                    </ul>
                                </div>
                                <!--end::Button Share-->
                            </div>
                            <!--end::Detail Content-->
                        </div>
                        <!--end::Row-->
                    </div>
                    <!--end::Col-->
                </div>
                <!--end:Row-->
            </div>
            <!--end product-->
        </div>
        <!--end::Row-->
        <!--begin::View Product decription-->
        <div class="modal fade popup_detail_desc" id="popupmodal_detail_decription" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <!--begin::Modal Content-->
                <div class="modal-content">
                    <!--begin::Modal Header-->
                    <div class="modal-header">
                        <p class="modal-title center h6" id="exampleModalLongTitle">Mô tả sản phẩm: @Model.product_name</p>
                        <a href="#" class="close bg-transparent" data-dismiss="modal" aria-label="Close">
                            <span class="material-icons" aria-hidden="true">close</span>
                        </a>
                    </div>
                    <!--end::Modal Header-->
                    <div class="modal-body detail_decs_product">
                        @Html.Raw(Model.description)
                    </div>
                    <!--begin::Modal Footer-->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-dismiss="modal">Đóng</button>
                    </div>
                    <!--begin::Modal Footer-->
                </div>
                <!--end::Modal Content-->
            </div>
        </div>
        <!--end::View Product decription-->
        <!--begin::Row-->
        <div class="row boderproductdetail pd_productdetail">
            <div class="col-md-12">
                <div class="full">
                    <!--begin::Tab Bars-->
                    <div class="tab_bar_section">
                        <!--begin::Nav Tabs-->
                        <ul class="nav nav-tabs" role="tablist">
                            <!--begin::Nav Item-->
                            <li class="nav-item"> <a class="nav-link active" data-toggle="tab" href="#description">Mô tả sản phẩm</a> </li>
                            <li class="nav-item"> <a class="nav-link " data-toggle="tab" href="#specs">Thông số kĩ thuật</a> </li>
                            <li class="nav-item"> <a class="nav-link" data-toggle="tab" href="#reviews">Đánh giá (@ViewBag.CountFeedback)</a> </li>
                            <!--end::Nav Item-->
                        </ul>
                        <!--end::Nav Tabs-->
                        <!--begin::Tab Content-->
                        <div class="tab-content">
                            <!--begin::Tab Panel-->
                            <div id="description" class="tab-pane active">
                                @if (Model.description == "" || Model.description == null)
                                {
                                    <div>Đang cập nhật</div>
                                }
                                else
                                {
                                    <!--begin::Decription-->
                                    <div class="product_desc">
                                        @Html.Raw(Model.description)
                                    </div>
                                    <!--end::Decription-->
                                    <div class="bg-article"></div>
                                    <!--begin::View More Decription-->
                                    <a href="#" data-toggle="modal" data-target="#popupmodal_detail_decription">
                                        <span class="btn-detail btn-short-spec not-have-instruction d-flex center btn_detail_decription">
                                            <span style="font-family: Roboto-Regular;margin-top: 7px;">Xem thêm nội dung</span><span class="material-icons">keyboard_arrow_down</span>
                                        </span>
                                    </a>
                                    <!--end::View More Decription-->
                                }
                            </div>
                            <!--end::Tab Panel-->
                            <!--begin::Tab Panel-->
                            <div id="specs" class="tab-pane fade">
                                <div id="specs" class="tab-pane ">
                                    @if (Model.specification == "" || Model.specification == null)
                                    {
                                        <div>Đang cập nhật</div>
                                    }
                                    else
                                    {
                                        <!--begin::Spectification-->
                                        <div class="product_spec">
                                            @Html.Raw(Model.specification)
                                        </div>
                                        <!--end::Spectification-->
                                    }
                                </div>
                            </div>
                            <!--end::Tab Panel-->
                            <!--begin::Tab Panel-->
                            <div id="reviews" class="tab-pane fade">
                                <div class="row">
                                    <!--begin::Product Review-->
                                    <div class="product_review col-lg-7">
                                        <h3 class="mb-25px">Đánh giá (@ViewBag.CountFeedback)</h3>
                                        @foreach (var fb in feedbackproduct)
                                        {
                                            if (fb.product_id == Model.product_id)
                                            {
                                                foreach (var ac in Accountfeedback)
                                                {

                                                    if (ac.account_id == fb.account_id && fb.status == "2")
                                                    {
                                                        <!--begin::Row-->
                                                        <div class="commant-text row">
                                                            <div class="col-lg-8">
                                                                <!--begin::User Name-->
                                                                <span class="font_roboto_medium">@ac.Name</span>
                                                                <!--end::User Name-->
                                                                <!--begin::Feedback Date-->
                                                                <span class="fs-14px text-muted">@fb.create_at.ToString("dd-MM-yyyy HH:mm")</span>
                                                                <!--end::Feedback Date-->
                                                                @{ string fbconfirm = "";
                                                                    string verify = "";
                                                                    foreach (var odt in OrderFeedback)
                                                                    {
                                                                        if (odt.Order.account_id == fb.account_id && odt.product_id == fb.product_id && odt.Order.status=="3")
                                                                        {

                                                                            fbconfirm = "Đã mua tại NVT";
                                                                            verify ="verified";
                                                                        }
                                                                    }
                                                                    <span class="fs-14px text-success"><span class="material-icons fs-14px">@verify</span>@fbconfirm</span>
                                                                }
                                                                <!--begin:Rating Star-->
                                                                <span class="rating">
                                                                    @if (fb.rate_star == 0)
                                                                    {
                                                                        <i class="fa fa-star-o" aria-hidden="true"></i>
                                                                        <i class="fa fa-star-o" aria-hidden="true"></i>
                                                                        <i class="fa fa-star-o" aria-hidden="true"></i>
                                                                        <i class="fa fa-star-o" aria-hidden="true"></i>
                                                                        <i class="fa fa-star-o" aria-hidden="true"></i>
                                                                    }
                                                                    else if (fb.rate_star == 1)
                                                                    {
                                                                        <i class="fa fa-star" aria-hidden="true"></i>
                                                                        <i class="fa fa-star-o" aria-hidden="true"></i>
                                                                        <i class="fa fa-star-o" aria-hidden="true"></i>
                                                                        <i class="fa fa-star-o" aria-hidden="true"></i>
                                                                        <i class="fa fa-star-o" aria-hidden="true"></i>
                                                                    }
                                                                    else if (fb.rate_star == 2)
                                                                    {
                                                                        <i class="fa fa-star" aria-hidden="true"></i>
                                                                        <i class="fa fa-star" aria-hidden="true"></i>
                                                                        <i class="fa fa-star-o" aria-hidden="true"></i>
                                                                        <i class="fa fa-star-o" aria-hidden="true"></i>
                                                                        <i class="fa fa-star-o" aria-hidden="true"></i>
                                                                    }
                                                                    else if (fb.rate_star == 3)
                                                                    {
                                                                        <i class="fa fa-star" aria-hidden="true"></i>
                                                                        <i class="fa fa-star" aria-hidden="true"></i>
                                                                        <i class="fa fa-star" aria-hidden="true"></i>
                                                                        <i class="fa fa-star-o" aria-hidden="true"></i>
                                                                        <i class="fa fa-star-o" aria-hidden="true"></i>
                                                                    }
                                                                    else if (fb.rate_star == 4)
                                                                    {
                                                                        <i class="fa fa-star" aria-hidden="true"></i>
                                                                        <i class="fa fa-star" aria-hidden="true"></i>
                                                                        <i class="fa fa-star" aria-hidden="true"></i>
                                                                        <i class="fa fa-star" aria-hidden="true"></i>
                                                                        <i class="fa fa-star-o" aria-hidden="true"></i>
                                                                    }
                                                                    else if (fb.rate_star == 5)
                                                                    {
                                                                        <i class="fa fa-star" aria-hidden="true"></i>
                                                                        <i class="fa fa-star" aria-hidden="true"></i>
                                                                        <i class="fa fa-star" aria-hidden="true"></i>
                                                                        <i class="fa fa-star" aria-hidden="true"></i>
                                                                        <i class="fa fa-star" aria-hidden="true"></i>
                                                                    }
                                                                </span>
                                                                <!--end:Rating Star-->
                                                                <!--begin::Feedback Content-->
                                                                <p class="msg">
                                                                    @fb.description
                                                                </p>
                                                                <!--end::Feedback Content-->
                                                                @foreach (var fbimg in feedbackimages)
                                                                {
                                                                    if (fbimg.feedback_id == fb.feedback_id)
                                                                    {
                                                                        <a data-fslightbox href="@fbimg.image">
                                                                            <img src="@fbimg.image" class="img_fb_product" />
                                                                        </a>
                                                                    }
                                                                }
                                                            </div>
                                                        </div>
                                                        <!--end::Row-->
                                                    }
                                                }
                                            }
                                        }
                                    </div>
                                    <!--begin::Row-->
                                    <div class="col-lg-5 mt-100px mb-50px">
                                        @{ double onestar1 = 1; int c_ontstar1 = 0; double truestar1 = 2; int c_truestar1 = 0;
                                            double threestar1 = 3; int c_threestar1 = 0; ; double fourstar1 = 4; int c_fourstar1 = 0;
                                            double fivestar1 = 5; int c_fivestar1 = 0; int totalrating1 = 0;
                                            foreach (var item in AvgFeedback)
                                            {
                                                foreach (var orderitem in OrderFeedback)
                                                {
                                                    if (orderitem.product_id == item.product_id &&item.product_id==Model.product_id && item.status=="2")
                                                    {
                                                        totalrating1++;
                                                        if (item.rate_star == 1)
                                                        {
                                                            c_ontstar1++;
                                                        }
                                                        if (item.rate_star == 2)
                                                        {
                                                            c_truestar1++;
                                                        }
                                                        if (item.rate_star == 3)
                                                        {
                                                            c_threestar1++;
                                                        }
                                                        if (item.rate_star == 4)
                                                        {
                                                            c_fourstar1++;
                                                        }
                                                        if (item.rate_star == 5)
                                                        {
                                                            c_fivestar1++;
                                                        }
                                                    }
                                                }
                                            }
                                            <div class="d-flex justify-content-center avg_feedback">
                                                @string.Format("{0:0.0}", ((onestar1 * c_ontstar1 / totalrating1) +
                                                (truestar1 * c_truestar1 / totalrating1) + (threestar1 * c_threestar1 / totalrating1) +
                                                (fourstar1 * c_fourstar1 / totalrating1) + (fivestar1 * c_fivestar1 / totalrating1)))
                                            </div>
                                            if ((((onestar1 * c_ontstar1 / totalrating1) + (truestar1 * c_truestar1 / totalrating1) +
                                            (threestar1 * c_threestar1 / totalrating1) + (fourstar1 * c_fourstar1 / totalrating1) +
                                            (fivestar1 * c_fivestar1 / totalrating1)) >= 1) && (((onestar1 * c_ontstar1 / totalrating1) +
                                            (truestar1 * c_truestar1 / totalrating1) + (threestar1 * c_threestar1 / totalrating1) +
                                            (fourstar1 * c_fourstar1 / totalrating1) + (fivestar1 * c_fivestar1 / totalrating1)) < 2))
                                            {
                                                <div class="rating d-flex justify-content-center">
                                                    <i class="fa fa-star" aria-hidden="true"></i>
                                                    @for (int i = 1; i < 5; i++)
                                                    {
                                                        <i class="fa fa-star-o" aria-hidden="true"></i>
                                                    }
                                                </div>
                                            }
                                            else if ((((onestar1 * c_ontstar1 / totalrating1) + (truestar1 * c_truestar1 / totalrating1) +
                                            (threestar1 * c_threestar1 / totalrating1) + (fourstar1 * c_fourstar1 / totalrating1) +
                                            (fivestar1 * c_fivestar1 / totalrating1)) >= 2) && (((onestar1 * c_ontstar1 / totalrating1) +
                                            (truestar1 * c_truestar1 / totalrating1) + (threestar1 * c_threestar1 / totalrating1) +
                                            (fourstar1 * c_fourstar1 / totalrating1) + (fivestar1 * c_fivestar1 / totalrating1)) < 3))
                                            {
                                                <div class="rating d-flex justify-content-center">
                                                    <i class="fa fa-star" aria-hidden="true"></i>
                                                    <i class="fa fa-star" aria-hidden="true"></i>
                                                    @for (int i = 1; i < 4; i++)
                                                    {
                                                        <i class="fa fa-star-o" aria-hidden="true"></i>
                                                    }
                                                </div>
                                            }
                                            else if ((((onestar1 * c_ontstar1 / totalrating1) + (truestar1 * c_truestar1 / totalrating1) +
                                            (threestar1 * c_threestar1 / totalrating1) + (fourstar1 * c_fourstar1 / totalrating1) +
                                            (fivestar1 * c_fivestar1 / totalrating1)) >= 3) && (((onestar1 * c_ontstar1 / totalrating1) +
                                            (truestar1 * c_truestar1 / totalrating1) + (threestar1 * c_threestar1 / totalrating1) +
                                            (fourstar1 * c_fourstar1 / totalrating1) + (fivestar1 * c_fivestar1 / totalrating1)) < 4))
                                            {
                                                <div class="rating d-flex justify-content-center">
                                                    <i class="fa fa-star" aria-hidden="true"></i>
                                                    <i class="fa fa-star" aria-hidden="true"></i>
                                                    <i class="fa fa-star" aria-hidden="true"></i>
                                                    @for (int i = 1; i < 3; i++)
                                                    {
                                                        <i class="fa fa-star-o" aria-hidden="true"></i>
                                                    }
                                                </div>
                                            }
                                            else if ((((onestar1 * c_ontstar1 / totalrating1) + (truestar1 * c_truestar1 / totalrating1) +
                                            (threestar1 * c_threestar1 / totalrating1) + (fourstar1 * c_fourstar1 / totalrating1) +
                                            (fivestar1 * c_fivestar1 / totalrating1)) >= 4) && (((onestar1 * c_ontstar1 / totalrating1) +
                                            (truestar1 * c_truestar1 / totalrating1) + (threestar1 * c_threestar1 / totalrating1) +
                                            (fourstar1 * c_fourstar1 / totalrating1) + (fivestar1 * c_fivestar1 / totalrating1)) < 5))
                                            {
                                                <div class="rating d-flex justify-content-center">
                                                    <i class="fa fa-star" aria-hidden="true"></i>
                                                    <i class="fa fa-star" aria-hidden="true"></i>
                                                    <i class="fa fa-star" aria-hidden="true"></i>
                                                    <i class="fa fa-star" aria-hidden="true"></i>
                                                    @for (int i = 1; i < 2; i++)
                                                    {
                                                        <i class="fa fa-star-o" aria-hidden="true"></i>
                                                    }
                                                </div>
                                            }
                                            else if (((onestar1 * c_ontstar1 / totalrating1) + (truestar1 * c_truestar1 / totalrating1) +
                                           (threestar1 * c_threestar1 / totalrating1) + (fourstar1 * c_fourstar1 / totalrating1) +
                                           (fivestar1 * c_fivestar1 / totalrating1)) == 5)
                                            {
                                                <div class="rating d-flex justify-content-center">
                                                    @for (int i = 1; i <= 5; i++)
                                                    {
                                                        <i class="fa fa-star" aria-hidden="true"></i>
                                                    }
                                                </div>
                                            }
                                            else
                                            {
                                                <div class="rating d-flex justify-content-center">
                                                    @for (int i = 1; i <=5 ; i++)
                                                    {
                                                        <i class="fa fa-star-o" aria-hidden="true"></i>
                                                    }
                                                </div>
                                            }
                                    <div class="d-flex justify-content-center fs-14px text-muted">(@ViewBag.CountFeedback lượt đánh giá)</div>
                                        }
                                        <div class="full review_bt_section d-flex justify-content-center">
                                            @if (User.Identity.IsAuthenticated)
                                            {
                                                if (User.Identity.GetRole() == "1")
                                                {
                                                    <button class="btn bg-button" data-toggle="modal" data-target="#addModal" id="button_add_rating">Thêm đánh giá</button>
                                                }
                                                else
                                                {
                                                    <a class="btn bg-danger">For User</a>
                                                }
                                            }
                                            else
                                            {
                                                <button class="btn bg-button rating_login">Thêm đánh giá</button>
                                            }
                                        </div>
                                    </div>
                                </div>
                                <!--end::Row-->
                                <!--end::Product Review-->
                            </div>
                            <!--end::Tab Panel-->
                        </div>
                        <!--end::Tab Content-->
                    </div>
                    <!--end::Tab Bars-->
                </div>
            </div>
        </div>
        <!--end::Row-->
        @if (relatedproduct.Count > 0)
        {
            <!--begin::Row-->
            <div class="row boderproductdetail pd_relatedproduct">
                <!--begin:Row-->
                <div class="row">
                    <!--begin::Col-->
                    <div class="col-md-12">
                        <div class="full">
                            <!--begin:Title Head-->
                            <div class="main_heading related_product_heading">
                                <p class="h4">Xem thêm sản phẩm cùng dòng @Model.genre_name</p>
                            </div>
                            <!--end:Title Head-->
                        </div>
                    </div>
                    <!--end::Col-->
                </div>
                <!--end:Row-->
                @foreach (var item in relatedproduct)//hiển thị những sản phẩm liên quan
                {
                    <!--begin::Col-->
                    <div class="col-md-3 pb_relatedproduct">
                        <!--begin::Product List-->
                        <div class="product_list">
                            <a href="/san-pham/@item.slug">
                                @*href bạn có thể thay bằng href="@Url.Action("Productdetail", "Products", new { id = @item.product_id })"*@
                                <div class="product_img"> <img class="img-responsive" src="@item.image" alt="@item.product_name"></div>
                                <div class="product_detail_btm">
                                    <!--begin::Product Name-->
                                    <div class="center">
                                        <p class="limitlinetext color_text_primary">@item.product_name</p>
                                    </div>
                                    <!--end::Product Name-->
                                </div>
                            </a>
                            <div class="product_detail_btm">
                                <div class="starratin">
                                    <div class="center"> <i class="fa fa-star" aria-hidden="true"></i> <i class="fa fa-star" aria-hidden="true"></i> <i class="fa fa-star" aria-hidden="true"></i> <i class="fa fa-star" aria-hidden="true"></i> <i class="fa fa-star-o" aria-hidden="true"></i> </div>
                                </div>
                                <!--begin::Product Price-->
                                <div class="product_price">
                                    <p>
                                        @if (item.Discount != null)
                                        {
                                            if ((item.Discount.discount_start < DateTime.Now && item.Discount.discount_end >= DateTime.Now) && item.Discount.status.Trim() == "1")//nếu ngày giảm giá bé hơn ngày hiện tài và ngày kết thúc phải lớn hơn hoặc bằng ngày hiện tại
                                            {
                                                <span class="old_price">@item.price.ToString("#,###₫")</span> <span class="new_price">@((item.price - item.Discount.discount_price).ToString("#,0₫"))</span>//hiển thị giá sau khi trừ khhuyến mãi
                                            }
                                            else
                                            {
                                                <span class="new_price">@item.price.ToString("#,###₫")</span>
                                            }
                                        }
                                        else
                                        {
                                            <span class="new_price">@item.price.ToString("#,###₫")</span>
                                        }
                                    </p>
                                </div>
                                <!--end::Product Price-->
                            </div>
                        </div>
                        <!--end::Product List-->
                    </div>
                    <!--end::Col-->
                }
            </div>
        }
        @if (newsproducts.Count > 0)
        {
            <div class="row boderproductdetail">
                <!--begin:Row-->
                <div class="row">
                    <!--begin::Col-->
                    <div class="col-md-12">
                        <div class="full">
                            <!--begin:Title Head-->
                            <div class="main_heading related_product_heading">
                                <p class="h4">Bài viết liên quan</p>
                            </div>
                            <!--end:Title Head-->
                        </div>
                    </div>
                    <!--end::Col-->
                </div>
                <!--end:Row-->
                @foreach (var item in newsproducts)
                {
                    <div class="col-lg-3 mb-3 product_related_post">
                        <div><a href="/tin-tuc/chu-de/@item.News.ChildCategory.slug" class="me-2 category_sidebar_url">@item.News.ChildCategory.name</a><a href="/tin-tuc/@item.News.slug"><img class="img_related_post" src="@item.News.image2" alt="@item.News.slug"></a></div>
                        <a href="/tin-tuc/@item.News.slug" class="post-url-side-bar">
                            @item.News.news_title
                        </a>
                    </div>
                }
            </div>
        }
        <!--end::Row-->
    </div>
    <!--end::Container-->
</div>
<!--end::section-->
<!--begin::rating product-->
<div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title h5 font_roboto_medium" id="exampleModalLongTitle">Đánh giá sản phẩm</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="RatingFromData" method="post" enctype="multipart/form-data" onsubmit="AjaxPost(this)">
                    <div onmouseout="CRateSelected()" class="star_ratingfb">
                        <i id="rate1" onmouseout="CRateOut(1)" onmouseover="CRateOver(1)" onclick="CRateClick(1)" class="fa fa-star-o" aria-hidden="true"></i>
                        <i id="rate2" onmouseout="CRateOut(2)" onmouseover="CRateOver(2)" onclick="CRateClick(2)" class="fa fa-star-o" aria-hidden="true"></i>
                        <i id="rate3" onmouseout="CRateOut(3)" onmouseover="CRateOver(3)" onclick="CRateClick(3)" class="fa fa-star-o" aria-hidden="true"></i>
                        <i id="rate4" onmouseout="CRateOut(4)" onmouseover="CRateOver(4)" onclick="CRateClick(4)" class="fa fa-star-o" aria-hidden="true"></i>
                        <i id="rate5" onmouseout="CRateOut(5)" onmouseover="CRateOver(5)" onclick="CRateClick(5)" class="fa fa-star-o" aria-hidden="true"></i>
                    </div>
                    <input hidden name="product_id" class="form-control" value="@Model.product_id" id="ProD_ID">
                    <input hidden name="genre_id" class="form-control" value="@Model.genre_id" id="Genre_ID">
                    <input hidden name="disscount_id" class="form-control" value="@Model.discount_id" id="Discount_ID">
                    <input hidden name="rate_star" class="form-control" id="lblRating">
                    <div class="form-group">
                        <label for="message-text" class="col-form-label">Nội dung đánh giá:</label>
                        <textarea disabled maxlength="200" rows="3" placeholder="Viết đánh giá của bạn tại đây" class="form-control form-control-solid" name="description" id="FBk_Content"></textarea>
                        <div id="the-count">
                            <span id="dcript_content_fb" class="me-2 font_roboto_medium" style="color:red;">Chọn mức sao đánh giá</span>
                            <span id="current">0</span>
                            <span id="maximum">/ 200</span>
                        </div>
                    </div>
                    <div>
                        <div>
                            <input type="file" name="UploadImage" hidden id="uploadimgrate" onchange="readURL(this);" />
                            <label class="btn_uploadimgrating" for="uploadimgrate">Thêm ảnh</label>
                            <img class="preimg_rate" />
                        </div>
                    </div>
                    <div class="d-flex justify-content-center mt-50px">
                        <button id="ConfirmAdd" disabled class="btn btn-primary">Gửi đánh giá</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<!--end::rating product-->
